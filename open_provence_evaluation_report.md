# OpenProvence分離プロジェクト評価レポート

## 概要

`sentence_transformers/pruning`から`open_provence`として分離したプロジェクトの評価結果です。
ベースライン（jpre-xs-msmarco-ja-minimal_20250730）との性能比較を行いました。

## 評価環境

### 実行コマンド
```bash
python scripts/evaluate.py \
    -m output/jpre-xs-msmarco-ja-minimal_20250730_092745/final_model \
    -j pruning-config/pruning_data_ja_v3.json \
    --thresholds 0.1 0.2 0.3 0.4 0.5 0.6 0.7
```

### 使用モデル
- **モデルパス**: `output/jpre-xs-msmarco-ja-minimal_20250730_092745/final_model`
- **ベースモデル**: hotchpotch/japanese-reranker-xsmall-v2
- **評価データ**: pruning-config/pruning_data_ja_v3.json

## 評価結果

### 最適閾値（0.3）での性能比較

| 指標 | ベースライン | OpenProvence | 差分 | 判定 |
|------|-------------|--------------|------|------|
| 精度（Precision） | 44.43% | 44.37% | -0.06% | ✓ |
| 再現率（Recall） | 99.28% | 99.28% | ±0.00% | ✓ |
| F1スコア | 0.6139 | 0.6133 | -0.0006 | ✓ |
| F2スコア | 0.7962 | 0.7958 | -0.0004 | ✓ |
| **F2.5スコア** | **0.8483** | **0.8481** | **-0.0002** | **✓** |
| FN（誤削除） | 5 | 5 | ±0 | ✓ |
| 圧縮率 | 17.9% | 17.8% | -0.1% | ✓ |

### 詳細な誤差行列（閾値0.3）

```
              予測
実際    削除      保持
削除    328 (TN)  860 (FP)
保持     5 (FN)  686 (TP)
```

### 閾値別詳細結果

| 閾値 | 精度 | 再現率 | F1スコア | F2スコア | TP | FP | TN | FN |
|------|------|--------|----------|----------|----|----|----|----|----|
| 0.1 | 36.87% | 100.00% | 0.5388 | 0.7449 | 691 | 1183 | 5 | 0 |
| 0.2 | 39.04% | 100.00% | 0.5616 | 0.7620 | 691 | 1079 | 109 | 0 |
| **0.3** | **44.37%** | **99.28%** | **0.6133** | **0.7958** | **686** | **860** | **328** | **5** |
| 0.4 | 54.11% | 91.46% | 0.6799 | 0.8037 | 632 | 536 | 652 | 59 |
| 0.5 | 54.71% | 60.49% | 0.5746 | 0.5924 | 418 | 346 | 842 | 273 |
| 0.6 | 64.65% | 27.79% | 0.3887 | 0.3136 | 192 | 105 | 1083 | 499 |
| 0.7 | 70.59% | 6.95% | 0.1265 | 0.0847 | 48 | 20 | 1168 | 643 |

## 検証結果

### ✅ 主要性能指標の一致
- [x] 最適閾値が0.3であること
- [x] F2.5スコアが0.8483±0.01の範囲内（実測値: 0.8481）
- [x] FN（誤削除）が5±2の範囲内（実測値: 5）
- [x] 再現率が99%以上（実測値: 99.28%）

### 性能差分の分析

OpenProvenceとして分離したモデルは、ベースラインとほぼ同一の性能を示しました：

1. **F2.5スコア**: 0.0002の差（0.02%）は統計的に有意ではない
2. **FN（誤削除）**: 完全に一致（5件）
3. **再現率**: 完全に一致（99.28%）
4. **圧縮率**: わずか0.1%の差

## まとめ

**OpenProvenceプロジェクトへの分離は成功しました。**

- すべての主要性能指標がベースラインの許容範囲内
- 誤削除（FN）数が完全に一致し、実用上の性能は同等
- クラス名変更（Pruning* → OpenProvence*）による影響なし
- 独立したプロジェクトとして正常に機能

## 技術的詳細

### 実装の変更点
1. **パッケージ名**: `sentence_transformers.pruning` → `open_provence`
2. **クラス名**: `PruningEncoder` → `OpenProvenceEncoder`（全クラスで同様）
3. **インポートパス**: すべて`open_provence`パッケージからのインポートに変更
4. **互換性レイヤー**: `sentence_transformers`の依存関係を解決するための最小限の実装を追加

### 今後の推奨事項
1. 独立したGitリポジトリとしての管理
2. PyPIへの公開準備
3. ドキュメントの整備
4. CI/CDパイプラインの構築