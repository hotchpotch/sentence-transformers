2025-07-09 08:00:19,677 - __main__ - INFO - 
==================================================
2025-07-09 08:00:19,677 - __main__ - INFO - Testing SAVE/LOAD functionality
2025-07-09 08:00:19,677 - __main__ - INFO - ==================================================

2025-07-09 08:00:22,460 - __main__ - INFO - âœ“ Saved reranking_pruning model to /tmp/tmp_hohaort/test_model
2025-07-09 08:00:23,175 - __main__ - INFO - âœ“ Loaded reranking_pruning model successfully
2025-07-09 08:00:25,144 - __main__ - INFO - âœ“ Saved pruning_only model to /tmp/tmpqb6m_2hp/test_model
2025-07-09 08:00:25,698 - __main__ - INFO - âœ“ Loaded pruning_only model successfully
2025-07-09 08:00:25,733 - __main__ - INFO - 
âœ… SAVE/LOAD functionality test PASSED

2025-07-09 08:00:25,839 - __main__ - INFO - 
==================================================
2025-07-09 08:00:25,839 - __main__ - INFO - Testing RERANKING + PRUNING mode with minimal dataset
2025-07-09 08:00:25,839 - __main__ - INFO - ==================================================

2025-07-09 08:00:25,839 - __main__ - INFO - Loading dataset: hotchpotch/wip-query-context-pruner-with-teacher-scores/ja-minimal
2025-07-09 08:00:30,263 - __main__ - INFO - Initializing PruningEncoder in reranking_pruning mode
2025-07-09 08:00:31,435 - __main__ - INFO - âœ“ Model initialized successfully
2025-07-09 08:00:31,435 - __main__ - INFO - âœ“ Data collator initialized successfully
2025-07-09 08:00:31,458 - __main__ - INFO - âœ“ Data collation successful. Batch keys: dict_keys(['ranking_targets', 'pruning_labels', 'batch_indices', 'doc_indices', 'docs_per_query'])
2025-07-09 08:00:31,458 - __main__ - INFO - âœ“ All required label columns present
2025-07-09 08:00:31,458 - __main__ - INFO - âœ“ Loss function initialized successfully
2025-07-09 08:00:31,488 - __main__ - INFO - âœ“ Forward pass successful. Output keys: dict_keys(['ranking_logits', 'pruning_logits', 'hidden_states'])
2025-07-09 08:00:31,714 - __main__ - INFO - âœ“ Loss computation successful. Loss value: 0.3654
2025-07-09 08:00:31,723 - __main__ - INFO - âœ“ Predict (ranking only) successful. Score: [0.09681489]
2025-07-09 08:00:31,730 - __main__ - INFO - âœ“ Predict with pruning successful. Compression ratio: 0.67
2025-07-09 08:00:31,730 - __main__ - INFO - âœ“ Output type is correct: RerankingPruningOutput
2025-07-09 08:00:31,730 - __main__ - INFO - 
âœ… RERANKING + PRUNING mode test PASSED for minimal dataset

2025-07-09 08:00:31,836 - __main__ - INFO - 
==================================================
2025-07-09 08:00:31,837 - __main__ - INFO - Testing PRUNING-ONLY mode with minimal dataset
2025-07-09 08:00:31,837 - __main__ - INFO - ==================================================

2025-07-09 08:00:31,837 - __main__ - INFO - Loading dataset: hotchpotch/wip-query-context-pruner-with-teacher-scores/ja-minimal
2025-07-09 08:00:34,242 - __main__ - INFO - Initializing PruningEncoder in pruning_only mode
2025-07-09 08:00:35,447 - __main__ - INFO - âœ“ Model initialized successfully
2025-07-09 08:00:35,447 - __main__ - INFO - âœ“ Data collator initialized successfully
2025-07-09 08:00:35,448 - sentence_transformers.pruning.data_collator - INFO - Note: 'labels' column found but will be ignored in pruning_only mode
2025-07-09 08:00:35,468 - __main__ - INFO - âœ“ Data collation successful. Batch keys: dict_keys(['pruning_labels', 'batch_indices', 'doc_indices', 'docs_per_query'])
2025-07-09 08:00:35,468 - __main__ - INFO - âœ“ Label columns correct for pruning_only mode
2025-07-09 08:00:35,468 - __main__ - INFO - âœ“ Loss function initialized successfully
2025-07-09 08:00:35,501 - __main__ - INFO - âœ“ Forward pass successful. Output keys: dict_keys(['pruning_logits', 'hidden_states'])
2025-07-09 08:00:35,721 - __main__ - INFO - âœ“ Loss computation successful. Loss value: 0.2754
2025-07-09 08:00:35,721 - __main__ - INFO - âœ“ Correctly raised error for predict without pruning: predict() returns ranking scores and is not available in pruning_only mode. Use prune_texts() or set apply_pruning=True.
2025-07-09 08:00:35,732 - __main__ - INFO - âœ“ prune_texts successful. First result: kept_ratio=0.00
2025-07-09 08:00:35,739 - __main__ - INFO - âœ“ Predict with pruning successful. Compression ratio: 1.00
2025-07-09 08:00:35,739 - __main__ - INFO - âœ“ Output type is correct: PruningOnlyOutput
2025-07-09 08:00:35,739 - __main__ - INFO - 
âœ… PRUNING-ONLY mode test PASSED for minimal dataset

2025-07-09 08:00:35,845 - __main__ - INFO - 
==================================================
2025-07-09 08:00:35,845 - __main__ - INFO - Testing RERANKING + PRUNING mode with small dataset
2025-07-09 08:00:35,845 - __main__ - INFO - ==================================================

2025-07-09 08:00:35,845 - __main__ - INFO - Loading dataset: hotchpotch/wip-query-context-pruner-with-teacher-scores/ja-small
2025-07-09 08:00:38,527 - __main__ - INFO - Initializing PruningEncoder in reranking_pruning mode
2025-07-09 08:00:39,576 - __main__ - INFO - âœ“ Model initialized successfully
2025-07-09 08:00:39,576 - __main__ - INFO - âœ“ Data collator initialized successfully
2025-07-09 08:00:39,596 - __main__ - INFO - âœ“ Data collation successful. Batch keys: dict_keys(['ranking_targets', 'pruning_labels', 'batch_indices', 'doc_indices', 'docs_per_query'])
2025-07-09 08:00:39,596 - __main__ - INFO - âœ“ All required label columns present
2025-07-09 08:00:39,596 - __main__ - INFO - âœ“ Loss function initialized successfully
2025-07-09 08:00:39,621 - __main__ - INFO - âœ“ Forward pass successful. Output keys: dict_keys(['ranking_logits', 'pruning_logits', 'hidden_states'])
2025-07-09 08:00:39,793 - __main__ - INFO - âœ“ Loss computation successful. Loss value: 0.7966
2025-07-09 08:00:39,802 - __main__ - INFO - âœ“ Predict (ranking only) successful. Score: [0.09681489]
2025-07-09 08:00:39,809 - __main__ - INFO - âœ“ Predict with pruning successful. Compression ratio: 0.33
2025-07-09 08:00:39,809 - __main__ - INFO - âœ“ Output type is correct: RerankingPruningOutput
2025-07-09 08:00:39,809 - __main__ - INFO - 
âœ… RERANKING + PRUNING mode test PASSED for small dataset

2025-07-09 08:00:39,899 - __main__ - INFO - 
==================================================
2025-07-09 08:00:39,900 - __main__ - INFO - Testing PRUNING-ONLY mode with small dataset
2025-07-09 08:00:39,900 - __main__ - INFO - ==================================================

2025-07-09 08:00:39,900 - __main__ - INFO - Loading dataset: hotchpotch/wip-query-context-pruner-with-teacher-scores/ja-small
2025-07-09 08:00:42,091 - __main__ - INFO - Initializing PruningEncoder in pruning_only mode
2025-07-09 08:00:43,393 - __main__ - INFO - âœ“ Model initialized successfully
2025-07-09 08:00:43,393 - __main__ - INFO - âœ“ Data collator initialized successfully
2025-07-09 08:00:43,394 - sentence_transformers.pruning.data_collator - INFO - Note: 'labels' column found but will be ignored in pruning_only mode
2025-07-09 08:00:43,414 - __main__ - INFO - âœ“ Data collation successful. Batch keys: dict_keys(['pruning_labels', 'batch_indices', 'doc_indices', 'docs_per_query'])
2025-07-09 08:00:43,414 - __main__ - INFO - âœ“ Label columns correct for pruning_only mode
2025-07-09 08:00:43,414 - __main__ - INFO - âœ“ Loss function initialized successfully
2025-07-09 08:00:43,441 - __main__ - INFO - âœ“ Forward pass successful. Output keys: dict_keys(['pruning_logits', 'hidden_states'])
2025-07-09 08:00:43,612 - __main__ - INFO - âœ“ Loss computation successful. Loss value: 0.3948
2025-07-09 08:00:43,612 - __main__ - INFO - âœ“ Correctly raised error for predict without pruning: predict() returns ranking scores and is not available in pruning_only mode. Use prune_texts() or set apply_pruning=True.
2025-07-09 08:00:43,623 - __main__ - INFO - âœ“ prune_texts successful. First result: kept_ratio=0.00
2025-07-09 08:00:43,629 - __main__ - INFO - âœ“ Predict with pruning successful. Compression ratio: 1.00
2025-07-09 08:00:43,630 - __main__ - INFO - âœ“ Output type is correct: PruningOnlyOutput
2025-07-09 08:00:43,630 - __main__ - INFO - 
âœ… PRUNING-ONLY mode test PASSED for small dataset

2025-07-09 08:00:43,720 - __main__ - INFO - 
==================================================
2025-07-09 08:00:43,720 - __main__ - INFO - ðŸŽ‰ ALL TESTS PASSED! ðŸŽ‰
2025-07-09 08:00:43,720 - __main__ - INFO - ==================================================

